<div class="section" id="overview">
<h3>プラグインの概要</h3>

<p>Blogのリストおよび、それぞれのカテゴリーのリストを表示するプラグインです。主な機能は以下のとおりです。</p>

<ul>
	<li>Nucleus v3.22 以降のFancyURLの$CONF['xxxKey']や別プラグインによるURLカスタマイズに対応したリンク作成</li>
	<li>Blog/カテゴリーの表示順制御、非表示設定 [管理画面で指定]</li>
	<li>カテゴリーリスト等を展開する・しないBlogの設定（カレントBlogのみカテゴリーリストを表示する、というような設定が可能）[スキン変数のパラメーターで指定]</li>
	<li>テンプレートからの他プラグインの呼び出し</li>
	<li>フラグテンプレート内や他プラグインのパラメーターとして、BlogMenuのテンプレート変数が利用可能</li>
	<li>Blogの別名（エイリアス）指定（本当は「My Weblog」という名前のBlogだけど、BlogMenuでは「Home」と表示する、ということが可能）[テンプレートで指定]</li>
	<li>モジュールによるテンプレート変数の追加（まぁ私が機能追加しやすいようにしただけなんですが）</li>
	<li>Nucleusのカテゴリーリストのようなリンク出力指定も可（archivelistやarchiveスキンでは、それらのパラメーターがURLに付く。またその場合、アーカイブスキンではカテゴリーの表示もその期間分に絞り込まれる。） [スキン変数のパラメーターで指定]</li>
</ul>
</div>

<div class="section" id="callplugin">
<h3>他プラグイン呼び出し機能についての注意</h3>

<p>Blogリスト本体および、カテゴリーリストのテンプレートに<code>&lt;%%プラグイン名%%&gt;</code> や、<code>&lt;%%プラグイン名(オプション,オプション2)%%&gt;</code>のように記述すると（%は２つ）、その時パースしているBlogを現在選択されているBlogとして他のプラグインを呼び出すことができます。オプション値にBlogMenuのテンプレート変数を使うことも可能です。ただし、これの利用については以下の注意点があります。</p>

<ol>
	<li><p>スキン変数のパラメーターでカテゴリーリストを展開しない指定をしたBlogでは、プラグインも呼び出されません。この指定にかかわらず常に呼び出すようにするには、<strong>プラグイン名の先頭に「+」（プラス）を付けてください（<code>&lt;%%+プラグイン名%%&gt;</code>）</strong>。これで常に呼び出されるようになります。</p></li>
	
	<li><p>「その時パースしているBlogを現在選択されているBlogとしてプラグインを呼び出す」ことを実現するために（これをしないとほとんどのプラグインが期待通りに動かない）、<strong>global変数の<var>$blog</var>を一時的に書き換えています</strong>。これにより、もしかすると呼び出したプラグインとは関係ない別のプラグインに影響があるかもしれません。何かおかしいときはまず、これを疑ってみてください。また、テンプレートにプラグイン呼び出しの記述をしたあとは、一応一通りBlogの動作を確認するようにしてください。</p></li>
</ol>
</div>

<div class="section" id="pluginoption">
<h3>プラグインオプションで設定できる項目</h3>

<p>プラグイン一覧ページのBlogMenuの行の「編集」というリンクをクリックすると、プラグインオプションページに入れます。ここでは次の設定が可能です。</p>

<ul>
	<li>同じ表示優先度を持つブログの表示順（デフォルト値）</li>
	<li>同じ表示優先度を持つカテゴリーの表示順（デフォルト値）</li>
	<li>カテゴリーのURLパラメーターの順序 （カテゴリーID→ブログID　または　ブログID→カテゴリーID）</li>
	<li>A-1: デフォルトブログのURLにblogidを付加するかどうか</li>
	<li>A-2: デフォルトブログに属するカテゴリーのURLにもblogidを付加するかどうか</li>
	<li>B-1: デフォルトブログとは異なるURLを持ったブログのURLにblogidを付加するかどうか</li>
	<li>B-2: B-1に該当するブログに属するカテゴリーのURLにもblogidを付加するかどうか</li>
	<li>[ノーマルURL用設定] ブログのURLが "/" で終わる場合、クエリストリング（catid等）の前に "index.php" を追加するかどうか</li>
	<li>Nucleusのブログ設定ページにも、カテゴリー表示優先度の編集フォームを表示するかどうか（これを「はい」にすると、BlogAdminもNucleusのブログ設定ページからカテゴリーの並び順を編集できるようになります）</li>
	<li>クイックメニューに管理画面へのリンクを表示するかどうか</li>
	<li>アンインストール時に、このプラグインのデータベースのテーブルも削除するかどうか</li>
</ul>
</div>

<div class="section" id="management">
<h3>プラグイン管理ページでできる操作</h3>

<p>プラグイン一覧ページのBlogMenuの行の「管理」というリンクをクリックすると、管理画面に入れます。ここでは次の操作が可能です。</p>

<ul>
	<li>モジュールの有効・無効の切り替え</li>
	<li>Blog・カテゴリーのデフォルトの表示優先度設定</li>
	<li>指定できる優先度のレベル数の設定</li>
	<li>各Blog・カテゴリーの表示優先度の設定</li>
	<li>テンプレートの作成・編集・削除</li>
</ul>

<p>これらについては詳しくは管理ページ内のポップアップヘルプを参照してください。</p>
</div>

<div class="section" id="skinvar">
<h3>スキンへの記述方法</h3>

<pre>
<code>&lt;%BlogMenu(<strong>テンプレート名</strong>,<i>展開指定</i>,<i>Blog表示・非表示指定</i>,<i>アーカイブ絞込み</i>,<i>Blog表示順</i>,<i>カテゴリー表示順</i>)%&gt;</code>

e.g. <code>&lt;%BlogMenu(default)%&gt;</code>
e.g. <code>&lt;%BlogMenu(default,@)%&gt;</code>
e.g. <code>&lt;%BlogMenu(mytemplate,,1/2/3,1)%&gt;</code>
e.g. <code>&lt;%BlogMenu(mytemplate,&lt;&gt;2,,0,bnumber asc,cname asc)%&gt;</code>
</pre>

<dl>
	<dt>テンプレート名（必須）</dt>
	<dd><p>BlogMenu管理画面で作成したテンプレートの名前</p></dd>
	
	<dt>展開指定</dt>
	<dd>
		<p>カテゴリーリストやプラグインの展開に関する指定です。</p>
		<ul>
			<li><p><code>@</code> ・・・現在選択されているBlogのみ、カテゴリーリストの表示やプラグインの呼び出しをします。他のBlogではテンプレートでの<code>&lt;%%categorylist%%&gt;</code>やプラグインの記述は無視されます。</p></li>
			<li><p><code>1/2/5</code> ・・・数値を記述すると、その数値がIDのブログのみカテゴリーリストの表示やプラグインの呼び出しをします。複数指定する場合はスラッシュで区切ってください。</p></li>
			<li><p><code>&lt;&gt;3/4</code> ・・・先頭に <code>&lt;&gt;</code> を付けて数値を記述すると、その数値がIDのブログでは、カテゴリーリストやプラグインを表示しません。複数指定する場合はスラッシュで区切ってください。</p></li>
		</ul>
		<p>この指定にかかわらず、常に呼び出したいプラグインがある場合は、<strong>プラグイン名の先頭に「+」（プラス）を付けてください（<code>&lt;%%+プラグイン名%%&gt;</code>）</strong>。</p>
	</dd>

	<dt>Blog表示・非表示指定</dt>
	<dd>
		<p>リストに表示する・しないBlogを指定します。</p>
		<ul>
			<li><p><code>1/2/5</code> ・・・数値を記述すると、その数値がIDのブログのみリストに表示します。複数指定する場合はスラッシュで区切ってください。</p></li>
			<li><p><code>&lt;&gt;3/4</code> ・・・先頭に <code>&lt;&gt;</code> を付けて数値を記述すると、その数値がIDのブログはリストに表示しません。複数指定する場合はスラッシュで区切ってください。</p></li>
		</ul>
	</dd>
	
	<dt>アーカイブ絞込み</dt>
	<dd>
		<p>アーカイブやアーカイブスキンにおいて、各リンクURLにそれらのパラメーター（archive/archivelist）を追加するかどうかの設定。これを「1」にした場合、アーカイブスキンではその期間に存在するカテゴリーとそのアイテム数のみ表示されるようになります。ただしアーカイブやアーカイブリストのパラメーターが付く場合、<strong>プラグインオプションでのblogidを付加しない設定等は無視されます</strong>（URLカスタマイズプラグインに対応するため）。このあたりはBlogMenuのテンプレートで&lt;%archivedate%&gt;を使えるようにしていますので、それでうまく調整してください。</p>
		
		<ul>
			<li><p><code>1</code> ... yes</p></li>
			<li><p><code>0</code> ... no</p></li>
		</ul>
	</dd>
	
	<dt>Blog表示順</dt>
	<dd>
		<p>同じ表示優先度のBlogが複数あった場合の並び順を指定します。この指定がない場合は、プラグインオプションで設定した並び順が使用されます。以下の４つのうちのいずれかを記述してください。</p>
		<ul>
			<li><code>bnumber asc</code> ・・・BlogID昇順</li>
			<li><code>bnumber desc</code> ・・・BlogID降順</li>
			<li><code>bname asc</code> ・・・Blog名昇順</li>
			<li><code>bname desc</code> ・・・Blog名降順</li>
		</ul>
	</dd>
	
	<dt>カテゴリー表示順</dt>
	<dd>
		<p>同じ表示優先度のカテゴリーが複数あった場合の並び順を指定します。この指定がない場合は、プラグインオプションで設定した並び順が使用されます。以下の４つのうちのいずれかを記述してください。</p>
		<ul>
			<li><code>catid asc</code> ・・・カテゴリーID昇順</li>
			<li><code>catid desc</code> ・・・カテゴリー降順</li>
			<li><code>cname asc</code> ・・・カテゴリー名昇順</li>
			<li><code>cname desc</code> ・・・カテゴリー名降順</li>
		</ul>
	</dd>
</dl>
</div>

